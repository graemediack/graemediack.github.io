<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>lazygrae messing about</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">

    <!-- Optional theme -->
    <!-- 
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap-theme.min.css" integrity="sha384-6pzBo3FDv/PJ8r2KRkGHifhEocL+1X2rVCTTkUfGk7/0pbek5mMa1upzvWbrUbOZ" crossorigin="anonymous">
     -->
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
    <script src="https://code.jquery.com/jquery-3.5.0.min.js" integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ=" crossorigin="anonymous"></script>
    
    <script src="resources/leaflet.ajax.min.js"></script>

    <script src='https://unpkg.com/@turf/turf/turf.min.js'></script>
    
    <style>
        #header {
            height: 75px;
            background-color: darkgoldenrod;
        }

        #mapdiv {
            height: 850px;
            background-color: salmon;
        }

        #side_panel {
            height: 850px;
            background-color: beige;
        }

        #footer {
            height: 75px;
            background-color: darkgrey;
        }

        .attraction {
            margin-bottom: 5px;
        }
    </style>
</head>

<body>
    <div id="header" class="col-md-12">
        <h1 class="text-center">Marine Science Scotland Observation Locations</h1>
    </div>
    <div id="side_panel" class="col-md-3">
        <h1 class="text-center">Observation Locations</h1>
        <button id="btnBuffer" class="form-control btn btn-warning attraction"></button>
    </div>
    <div id="mapdiv" class="col-md-9"></div>
    <div id="footer" class="col-md-12">
        <h4 id="map_coords" class="text-center">Latitude: 57.0 Longitude: -5.0 Zoom: 6</h4>
        <h4 class="text-center">Thanks to <a href="http://millermountain.com" target='_blank'>Miller Mountain LLC</a> for GIS and Web courses!</h4>
    </div>
    <script>
        // add map object to mapdiv
        var mymap = L.map('mapdiv')
        mymap.setView([57, -5], 6);
        // add background layer
        var backgroundLayer = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png');
        mymap.addLayer(backgroundLayer);

        // import layer data from geoJSON file
                       
        var geojsonLayer = new L.GeoJSON.AJAX('data/MSS_ObsLocations.geojson', {pointToLayer:
        function(feature, latlng) {
            // create buttons from geoJSON data
            var str = "<button id='zoomTo"+feature.properties.Site.replace(/ /g, '');
            str += "' class='form-control btn btn-primary attraction'>";
            str += feature.properties.Site+"</button>";
            $("#side_panel").append(str);

            $("#zoomTo"+feature.properties.Site.replace(/ /g, '')).click(function() {
                mymap.setView([latlng.lat, latlng.lng], 17);
            });
            // create markers from geoJSON data
            var str = "<h4>"+feature.properties.Site+"</h4>";
            return L.marker(latlng).bindPopup(str);
        }});

        geojsonLayer.addTo(mymap);

        var bufferLayer;
        $("#btnBuffer").click(function() {
            if ($("#btnBuffer").html()=="Buffer") {
                var bufferedMarkers = turf.buffer(geojsonLayer.toGeoJSON(), 1, {units: 'miles'});
                bufferLayer = L.GeoJSON(bufferedMarkers).addTo(mymap);
                $("#btnBuffer").html("Remove Buffer");
            } else {
                mymap.removeLayer(bufferLayer);
                $("#btnBuffer").html("Buffer");
            }
        });

        mymap.on('mousemove', function(e){
            var str = "Latitude: "+e.latlng.lat.toFixed(5)+" Longitude: "+e.latlng.lng.toFixed(5)+" Zoom Level: "+mymap.getZoom();
            $("#map_coords").html(str);
        })
    </script>

</body>

</html>
