<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>lazygrae messing about</title>
    
    <!-- Latest compiled and minified CSS -->
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin="" />
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap-theme.min.css" integrity="sha384-6pzBo3FDv/PJ8r2KRkGHifhEocL+1X2rVCTTkUfGk7/0pbek5mMa1upzvWbrUbOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="resources/local.css">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://code.jquery.com/jquery-3.5.0.min.js" integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ=" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
    <script src="resources/leaflet.ajax.min.js"></script>
    <script src="resources/turf.min.js"></script>
</head>
    <body>
        <script language="javascript" type="text/javascript" src="resources/header.txt"></script>
        <div id="side_panel" class="col-md-3">
            <p class="text-left">Marine Scotland Science Observation Locations</p>
            <button id="btnBuffer" class="form-control btn btn-warning attraction">Buffer</button>
            <button id="btnVoronoi" class="form-control btn btn-warning attraction">Voronoi</button>
            <button id="btnTin" class="form-control btn btn-warning attraction">Tin</button>
            
            <select id="selectMSSObsCat" class="custom-select attraction">
                <option selected>Select a Location Category:</option>
                <option value="Coastal Observatory Sites">Coastal Observatory Sites</option>
                <option value="West Coast Rivers">West Coast Rivers</option>
                <option value="East Coast Rivers">East Coast Rivers</option>
                <option value="Scottish Sea Areas">Scottish Sea Areas</option>
                <option value="Met Stations">Met Stations</option>
            </select>
            
        </div>
        <div id="mapdiv" class="col-md-9"></div>
        <div id="footer" class="col-md-12">
            <p id="map_coords" class="text-center">Latitude: 57.0 Longitude: -5.0 Zoom: 6</p>
            <p class="text-center">Thanks to <a href="http://millermountain.com" target='_blank'>Miller Mountain LLC</a> for GIS and Web courses!</p>
        </div>
        <script>
            // add map object to mapdiv
            var mymap = L.map('mapdiv')
            mymap.setView([57, -5], 6);
            // add background layer
            var backgroundLayer = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png');
            mymap.addLayer(backgroundLayer);
            // add all observation locations as little orange dots
            var MSS_ObsLocLayerMarkerOptions = {
                radius: 3,
                fillColor: "#ff7800",
                color: "#000",
                weight: 1,
                opacity: 1,
                fillOpacity: 0.8
            };

            var MSS_ObsLocLayer = new L.GeoJSON.AJAX('data/MSS_ObsLocations.geojson', {pointToLayer: function(feature, latlng) {
                return L.circleMarker(latlng, MSS_ObsLocLayerMarkerOptions);
                }
            }).addTo(mymap);
            
            // add and remove buffer to all objects using buffer button
            var bufferLayer = L.geoJSON();
            $("#btnBuffer").click(function(){
                
                if ($("#btnBuffer").html()=='Buffer') {
                    var bufferedLocations = turf.buffer(MSS_ObsLocLayer.toGeoJSON(), 15, {units:'kilometres'});
                    bufferLayer = L.geoJSON(bufferedLocations).addTo(mymap);
                    $("#btnBuffer").html("Remove Buffer");
                } else {
                    mymap.removeLayer(bufferLayer);
                    $("#btnBuffer").html("Buffer");
                }
            });
            
            var voronoiLayer = L.geoJSON();
            $("#btnVoronoi").click(function(){
                
                if ($("#btnVoronoi").html()=='Voronoi') {
                    var voronoiLocations = turf.voronoi(MSS_ObsLocLayer.toGeoJSON());
                    voronoiLayer = L.geoJSON(voronoiLocations).addTo(mymap);
                    $("#btnVoronoi").html("Remove Voronoi");
                } else {
                    mymap.removeLayer(voronoiLayer);
                    $("#btnVoronoi").html("Voronoi");
                }
            });
            
            var tinLayer = L.geoJSON();
            $("#btnTin").click(function(){
                
                if ($("#btnTin").html()=='Tin') {
                    var tinLocations = turf.tin(MSS_ObsLocLayer.toGeoJSON());
                    tinLayer = L.geoJSON(tinLocations).addTo(mymap);
                    $("#btnTin").html("Remove Tin");
                } else {
                    mymap.removeLayer(tinLayer);
                    $("#btnTin").html("Tin");
                }
            });
            
            
            // highlight particular categories using drop down and view button
            var categorySelect = L.geoJSON();
            $("#selectMSSObsCat").click(function(){
                mymap.removeLayer(categorySelect);
                categorySelect = new L.GeoJSON.AJAX('data/MSS_ObsLocations.geojson', {filter: locationCatFilter}).addTo(mymap);
            });
            
            function locationCatFilter(feature) {
                if (feature.properties.Category == $("#selectMSSObsCat").val()) {
                    return true;
                } 
            };
            
            
            mymap.on('mousemove', function(e){
                var str = "Latitude: "+e.latlng.lat.toFixed(5)+" Longitude: "+e.latlng.lng.toFixed(5)+" Zoom Level: "+mymap.getZoom();
                $("#map_coords").html(str);
            });
            
        </script>
    </body>
</html>